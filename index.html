<!DOCTYPE html>
resultado.style.display = 'block';
resultado.innerHTML = `
<h2>Resultado da análise</h2>
<p class="small"><strong>Sintomas selecionados:</strong> ${sel.join(', ')}</p>
<p class="small"><strong>Probabilidade geral:</strong> ${total}% — ${nivel}</p>
<hr style="border-color:rgba(255,255,255,0.04); margin:14px 0;">
<h3>Doença mais provável</h3>
<p><strong>${melhor ? melhor.nome : 'Nenhuma encontrada'}</strong> — <span class="badge" style="background:${melhor ? (melhor.urgencia === 'Alta' ? 'var(--danger)' : melhor.urgencia === 'Média' ? 'var(--accent)' : 'var(--accent2)') : 'rgba(255,255,255,0.04)'}">${melhor ? melhor.urgencia : '-'}</span></p>
<div class="recs">
<h4 style="margin-bottom:6px;">Recomendações</h4>
<ul>
${recomendacoes.map(r => `<li>${r}</li>`).join('')}
</ul>
</div>
<p class="small" style="margin-top:10px;">Esta ferramenta é educativa. Em caso de dúvida ou emergência, procure um profissional de saúde.</p>
`;


// salvar no histórico
historico.unshift({sintomas: sel, prob: total, doenca: melhor ? melhor.nome : null, hora: new Date().toISOString()});
if(historico.length > 20) historico.pop();
renderHistorico();
}


function compareUrgencia(a, b){
const map = { 'Crítica': 3, 'Alta': 3, 'Média': 2, 'Baixa': 1, null: 0 };
return (map[a]||0) - (map[b]||0);
}


function renderHistorico(){
if(historico.length === 0){ historicoEl.style.display = 'none'; return; }
historicoEl.style.display = 'block';
historicoEl.innerHTML = '<strong>Histórico das últimas análises</strong>' + historico.map(h => `
<div class="history-item">
<div>
<div style="font-weight:600">${h.doenca || 'Sem correspondência'}</div>
<div class="small">Sintomas: ${h.sintomas.join(', ')}</div>
</div>
<div class="small">${h.prob}% — ${new Date(h.hora).toLocaleString()}</div>
</div>
`).join('');
}


function limpar(){
// limpar seleção e resultado
document.querySelectorAll('#symptomGrid input[type=checkbox]').forEach(i => i.checked = false);
resultado.style.display = 'none';
}


// ligar eventos
analyzeBtn.addEventListener('click', analisar);
clearBtn.addEventListener('click', limpar);


// inicialização
renderSymptoms();
// tentar restaurar histórico do localStorage (opcional)
try{ const stored = localStorage.getItem('ia_diag_history'); if(stored) { historico = JSON.parse(stored); renderHistorico(); } }catch(e){ /* ignore */ }
// salvar histórico ao sair
window.addEventListener('beforeunload', ()=>{ try{ localStorage.setItem('ia_diag_history', JSON.stringify(historico)); }catch(e){} });


})();
</script>
</body>
</html>
